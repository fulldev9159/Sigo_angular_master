<p-confirmPopup></p-confirmPopup>
<div class="section">
    <div class="left-navbar"></div>
    <div class="content ui segment">
        <div class="title">Ingreso de una cubicación</div>
        <form [formGroup]="form">
            <div class="form-content">
                <div class="left-form">
                    <div class="field">
                        <label>Nombre*</label>
                        <!-- <span class="error" *ngIf="NombreErr">* Debe ingresar el nombre</span> -->
                        <input type="text" class="nombre-cubicacion" [formControlName]="'nombre'" name="nombre"
                            id="nombre">
                    </div>
                    <div class="field">
                        <label>Contrato*</label>
                        <div (click)="confirm($event,'contratoId')">
                            <select [formControlName]="'contratoId'" name="contratoId" id="contratoId"
                                (change)="selectedContrato()">
                                <option value="">Seleccione un contrato...</option>
                                <option *ngFor="let contrato of contratosArr" value="{{contrato.id}}">
                                    {{contrato.nombre}}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="field">
                        <label>Proveedor*</label>
                        <div (click)="confirm($event,'proveedorId')">
                            <select name="proveedorId" id="proveedorId" (change)="selectedProveedor()"
                                [formControlName]="'proveedorId'">
                                <option value="">Seleccione un proveedor.... </option>
                                <option *ngFor="let proveedor of proveedorArr" value="{{proveedor.id}}">
                                    {{proveedor.nombre}}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="field">
                        <label>Región*</label>
                        <div (click)="confirm($event,'regionId')">
                            <select name="regionId" id="regionId" (change)="selectedRegion()"
                                [formControlName]="'regionId'">
                                <option value="">Seleccione una región...</option>
                                <option *ngFor="let region of regionArr" value="{{region.id}}">{{region.codigo}}
                                    {{region.nombre}}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="right-form">
                    <div class="field">
                        <label>Tipo de servicio*</label>
                        <select name="tiposervicioId" id="tiposervicioId" (change)="selectedTipoServicio()"
                            [formControlName]="'tiposervicioId'">
                            <option value="">Seleccione un tipo de servicio....</option>
                            <option *ngFor="let tiposervicio of tipoServicioArr" value="{{tiposervicio.id}}">
                                {{tiposervicio.nombre}}</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>Servicios*</label>
                        <p-listbox (click)="getTotal()" [options]="(sourceProducts$|async)!" [(ngModel)]="selectedServicios" [ngModelOptions]="{standalone: true}"
                            [metaKeySelection]="false" [checkbox]="true" [filter]="true" [multiple]="true"
                            optionLabel="nombre" [listStyle]="{'max-height':'250px'}"
                            [style]="{'width':'56rem','height':'285px'}">
                            <ng-template let-servicio pTemplate="item">
                                <div class="country-item">
                                    <div>{{servicio.nombre}}</div>
                                </div>
                            </ng-template>
                        </p-listbox>
                    </div>
                </div>
            </div>
            <div class="carro">
                <div class="title-carro">
                    Resumen de Servicios
                    <div class="buttons-carro">
                        <div class="ui buttons">
                            <button class="ui button" (click)="limpiarCarro($event)">Limpiar selecciones</button>
                            <div class="or"></div>
                            <div pTooltip="Debe escoger servicios y llenar todos los campos" tooltipPosition="top">
                                <button *ngIf="!valid" class="ui positive button active" disabled>Finalizar
                                    Cubicación</button></div>
                            <button *ngIf="valid" class="ui positive button active" (click)="save()" id="guardarCubicacion">Finalizar
                                Cubicación</button>
                        </div>
                    </div>
                </div>
                <table class="table-carro">
                    <tr>
                        <th style="width: 318px"> Descripcion</th>
                        <th style="width: 269px">Región</th>
                        <th style="width: 140px">Tipo Servicio</th>
                        <th style="width: 102px">Cantidad</th>
                        <th style="width:125px">Unidad</th>
                        <th style="width:125px">Precio</th>
                        <th style="width:125px">Sub Total</th>
                        <th style="width:125px">Opciones</th>
                    </tr>
    
                    <tr *ngFor="let itemC of selectedServicios; let i = index">
                        <td> <span>{{itemC.nombre}}</span></td>
                        <td class="center">{{itemC.region}}</td>
                        <td class="center">{{itemC.tiposervicio}}</td>
                        <td class="center">
                            <select (change)="getTotal()" name="cantidad-{{itemC.id_lpu}}" id="cantidad-{{itemC.id_lpu}}"
                                [(ngModel)]="selectedServicios[i].cantidad" [ngModelOptions]="{standalone: true}">
                                <option *ngFor="let numero of counter(5) ;let j = index" value="{{j+1}}">
                                    {{j+1}}</option>
                            </select>
                        </td>
                        <td class="center">UNIDAD</td>
                        <td class="center">${{itemC.precio| number: '1.0-0':'es-CL'}}</td>
                        <td class="center">${{itemC.precio * itemC.cantidad|number: '1.0-0':'es-CL'}}</td>
                        <td class="center"><button  (click)="elimnarLPU(i)" class=" ui icon button red"  pTooltip="Eliminar LPU" tooltipPosition="top" placeholder="Top">
                            <i class="trash icon"></i>
                          </button></td>
                    </tr>
                    <tr>
                        <td colspan="7" style="text-align: right">
                            <span style="    
                                    margin-right: 31px;"><strong>Total</strong>: {{total| number: '1.0-0':'es-CL'}}</span>
                        </td>
                    </tr>
                </table>


            </div>
        </form>
    </div>
</div>
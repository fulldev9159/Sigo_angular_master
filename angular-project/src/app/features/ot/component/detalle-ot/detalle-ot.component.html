<app-tabs (tabSelected)="tabSelected($event)">
  <app-tab label="Información" icon="pi pi-fw pi-info-circle">
    <div class="row" style="padding: 15px;">
      <div class="col-xs-12 col-md-6">
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Información de sistema</ng-container>
          <ng-container card-body>
            <ul>
              <li>SCE session: <span style="margin-right:6.6em"></span>{{detalleOt ?detalleOt.sce_sesion : ' ---'}}</li>
              <li>Etapa: <span style="margin-right:9.3em"></span>{{detalleOt ? detalleOt.tipo_etapa_ot.nombre : ' ---'}}</li>
              <li>Estado: <span style="margin-right:8.8em"></span>{{detalleOt ? detalleOt.tipo_estado_ot.nombre : ' ---'}}</li>
              <li>Tipo: <span style="margin-right:9.8em"></span> {{detalleOt ? detalleOt.tipo : ' ---'}}</li>
            </ul>
          </ng-container>
        </app-card>
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Fechas</ng-container>
          <ng-container card-body>
            <ul>
              <li>Fecha Inicio OT: <span style="margin-right:5em"></span>{{detalleOt ? (detalleOt.fecha_inicio|date:"dd/MM/yyyy"): "---"}}</li>
              <li>Fecha Fin OT: <span style="margin-right:6.1em"></span>{{detalleOt ? (detalleOt.fecha_fin|date:"dd/MM/yyyy") : ' ---'}}</li>
            </ul>
          </ng-container>
        </app-card>
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Información adicional</ng-container>
          <ng-container card-body>
            <ul>
              <li>Propietario: <span style="margin-right:7em"></span>{{detalleOt ?detalleOt.propietario_nombre : ' ---'}}</li>
              <li>Responsable: <span style="margin-right:6.4em"></span>{{detalleOt ? detalleOt.responsable_nombre : ' ---'}}</li>
              <li>Fecha de creación: <span style="margin-right:4em"></span>{{detalleOt ? (detalleOt.created_at|date:"dd/MM/yyyy") : ' ---'}}</li>
              <li>Proyecto: <span style="margin-right:8.1em"></span> {{detalleOt ? detalleOt.proyecto_nombre : ' ---'}}</li>
              <li>Observaciones: <span style="margin-right:5.6em"></span> {{detalleOt ?detalleOt.observaciones : ' ---'}}</li>
            </ul>
          </ng-container>
        </app-card>
      </div>
      <div class="col-xs-12 col-md-6">
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Plan de proyecto</ng-container>
          <ng-container card-body>
            <ul>
              <li>Plan:<span style="margin-right:10em"></span>{{detalleOt ? detalleOt.plan_nombre : ' ---' }}</li>
              <li>Código:<span style="margin-right:8.7em"></span>{{detalleOt ? detalleOt.sitio.codigo : ' ---'}}</li>
              <li>Nombre sitio:<span style="margin-right:6.01em"></span>{{detalleOt ? detalleOt.sitio.nombre : ' ---'}}</li>
              <li>Dirección:<span style="margin-right:7.7em"></span>{{detalleOt ? detalleOt.sitio.direccion: ' ---' }} </li>
              <li>Latitud: <span style="margin-right:8.5em"></span>{{detalleOt ? detalleOt.sitio.geo_lat : ' ---' }}</li>
              <li>Longitud:<span style="margin-right:7.9em"></span>{{detalleOt ? detalleOt.sitio.geo_lon : ' ---' }} </li>
            </ul>
          </ng-container>
        </app-card>


        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Sustento Financiero</ng-container>
          <ng-container card-body>
            <ul>
              <li>Tipo:<span style="margin-right:10em"></span>{{detalleOt ? detalleOt.sustento_financiero.tipo_sustento : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.capex!==null">PMO:<span style="margin-right:9.7em"></span>{{detalleOt ? detalleOt.sustento_financiero.capex.pmo_codigo : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.capex!==null">Línea presupuestaria:<span style="margin-right:2.61em"></span>{{detalleOt ? detalleOt.sustento_financiero.capex.lp_codigo : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.capex!==null">PEP2:<span style="margin-right:9.72em"></span>{{detalleOt ? detalleOt.sustento_financiero.capex.pep2_codigo : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.capex_provisorio!==null">PMO:<span style="margin-right:9.7em"></span>{{detalleOt ? detalleOt.sustento_financiero.capex_provisorio.pmo_codigo : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.capex_provisorio!==null">Línea presupuestaria:<span style="margin-right:2.8em"></span>{{detalleOt ? detalleOt.sustento_financiero.capex_provisorio.lp_codigo : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.capex_provisorio!==null">PEP2 Provisorio*:<span style="margin-right:15em"></span>{{detalleOt ? detalleOt.sustento_financiero.capex_provisorio.pep2_codigo : ' ---' }}</li>

              <li *ngIf="detalleOt && detalleOt.sustento_financiero.opex!==null">ID Opex:<span style="margin-right:9.7em"></span>{{detalleOt ? detalleOt.sustento_financiero.opex.id_opex : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.opex!==null">Cuenta SAP:<span style="margin-right:2.8em"></span>{{detalleOt ? detalleOt.sustento_financiero.opex.cuenta_sap : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.opex!==null">CECO:<span style="margin-right:10em"></span>{{detalleOt ? detalleOt.sustento_financiero.opex.ceco_codigo : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.opex_provisorio!==null">ID Opex:<span style="margin-right:9.7em"></span>{{detalleOt ? detalleOt.sustento_financiero.opex_provisorio.id_opex : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.opex_provisorio!==null">Cuenta SAP:<span style="margin-right:2.8em"></span>{{detalleOt ? detalleOt.sustento_financiero.opex_provisorio.cuenta_sap : ' ---' }}</li>
              <li *ngIf="detalleOt && detalleOt.sustento_financiero.opex_provisorio!==null">CECO Provisorio*:<span style="margin-right:15em"></span>{{detalleOt ? detalleOt.sustento_financiero.opex_provisorio.ceco_codigo : ' ---' }}</li>
            </ul>
          </ng-container>
        </app-card>
      </div>
    </div>
  </app-tab>

  <app-tab label="Costeo" icon="pi pi-fw pi-dollar">
    <div class="row" style="padding: 15px;">
      <div class="col-xs-12 col-md-6">
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Detalle de la Cubicación: {{detalleOt ? detalleOt.cubicacion_nombre : ' ---'}} </ng-container>
          <ng-container card-body>
            <ul>
              <li>Contrato: <span style="margin-right:8em"></span>{{detalleOt ? detalleOt.contrato_marco_nombre : ' ---'}}</li>
              <li>Proveedor: <span style="margin-right:7.3em"></span>{{detalleOt ? detalleOt.proveedor_nombre : ' ---'}}</li>
              <li>Región: <span style="margin-right:8.8em"></span>{{detalleOt ? detalleOt.sitio.region_nombre : ' ---'}}</li>
              <ng-container *ngxPermissionsOnly="['OT_VER_VALOR_LPU']">
                <li>Total: <span style="margin-right:9.8em"></span> {{detalleOt ? (detalleOt.total|currency : detalleOt.total_tipo_moneda : detalleOt.total_tipo_moneda===''?'':detalleOt.total_tipo_moneda + ' $':'.0-2':'es-CL') : ' ---'}}</li>
              </ng-container>
              <button (click)="getLPUs(detalleOt.cubicacion_id)" class="btn btn-primary" style="width: 83px;
  font-size: 12px;
  margin-top: 10px;
  margin-left: -19px;">Ver Lpus</button>
            </ul>
          </ng-container>
        </app-card>
      </div>
    </div>
  </app-tab>

  <app-tab label="Acta" icon="pi pi-fw pi-file-o" [disabled]="true">Acta</app-tab>
  <app-tab label="Libro de obra" icon="pi pi-fw pi-book">
    {{registroLibroObras|json}}
    <div class="row" style="padding: 15px;">
      <div class="col-12" *ngFor="let registro of registosLibroDeObras$|async ">
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title><strong>Rol: </strong> {{registro.rol}} --- <strong>Autor:</strong> {{registro.autor}} </ng-container>
          <ng-container card-body>
            <div class="row">
              <div class="col-md-9">
                {{registro.observacion}}
              </div>
              <div class="col-md-3" style="display: flex;flex-direction: column;">
                <p>Adjuntos</p>
                <span *ngFor="let adjunto of registro.adjuntos"><i class="pi" [ngClass]="getIcon(adjunto.type)"></i> <a href="">{{adjunto.nombre}}</a> {{adjunto.peso}}</span>
              </div>
            </div>
          </ng-container>
        </app-card>
      </div>
      <!-- <div class="col-12">
        <app-card [classCardHeader]="'bg-info'">
          <ng-container card-header-title>Autor: Pepito los palotes 02-03-2021 Rol:Administrador</ng-container>
          <ng-container card-body>
            <div class="row">
              <div class="col-md-9">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus egestas mauris augue, et finibus orci pharetra nec. Praesent nec ex vitae mauris bibendum fringilla ut vehicula felis. Aliquam in dictum augue, in porta nibh. Cras sodales felis finibus tortor bibendum, vel porttitor erat commodo. Suspendisse augue ante, convallis eu augue sit amet, vehicula eleifend nisi. Phasellus dolor augue, faucibus ac lacus non, pulvinar luctus velit. Sed fermentum tempus odio eget pharetra. Proin vehicula odio velit, vel egestas tellus tristique in. Integer condimentum magna urna, et finibus velit luctus sit amet. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Integer ac risus accumsan, bibendum sem vitae, posuere tellus.

                Etiam imperdiet, magna sed iaculis ornare, elit neque vestibulum enim, scelerisque hendrerit enim augue et ligula. Proin congue neque lorem, vitae porta odio ultrices in. Quisque tincidunt turpis sit amet nibh mollis blandit. Mauris viverra facilisis magna non aliquet. Nulla molestie felis tellus, vel luctus risus tristique et. Cras mattis convallis nibh, a gravida diam blandit eu. Ut velit mauris, facilisis vel convallis in, cursus vel nibh. Proin metus arcu, rhoncus vel risus ac, vestibulum finibus ex. Quisque a tincidunt est. Maecenas gravida orci dolor, ut commodo risus dignissim sed.

                Nulla volutpat semper massa, vel laoreet nibh elementum eu. Fusce feugiat neque sit amet lacus viverra faucibus. Etiam iaculis sagittis risus, sed iaculis eros egestas eget. Phasellus convallis viverra fringilla. Vivamus posuere consequat ipsum, sit amet tincidunt erat aliquet nec. Nulla faucibus nibh at dolor efficitur placerat. Quisque elementum tempor magna, at pulvinar nulla. Sed varius, elit eget malesuada pellentesque, felis metus euismod mi, in mattis lorem sem ut enim. Cras laoreet consequat nunc, vitae fermentum lacus sodales nec. In hac habitasse platea dictumst. Quisque ut malesuada elit. Aliquam molestie eros vitae eros suscipit, a finibus purus posuere. Integer viverra fermentum ligula, sit amet mattis orci pulvinar scelerisque. Mauris at convallis libero. In hac habitasse platea dictumst.
              </div>
              <div class="col-md-3" style="display: flex;flex-direction: column;">
                <p>Adjuntos</p>
                <span><i class="pi pi-file"></i> <a href="">Documento.docx</a></span>

                <span><i class="pi pi-file-pdf"></i> <a href="">Documento.pdf</a> </span>
                <span><i class="pi pi-image"></i> <a href="">imagen.jpeg</a></span>
              </div>
            </div>
          </ng-container>
        </app-card>
      </div> -->
    </div>
  </app-tab>
  <app-tab label="Anexos" icon="pi pi-fw pi-paperclip">
    <div class="card">
      <h5>Archivos adjuntos a la OT</h5>
      <p-table [value]="adjuntos" [(selection)]="adjuntosSelected" dataKey="code" responsiveLayout="scroll">
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 3rem">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th>Autor</th>
            <th>Nombre</th>
            <th>Fecha</th>
            <th>Type</th>
            <th>Peso</th>
            <th>Descargar</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
          <tr>
            <td>
              <p-tableCheckbox [value]="product"></p-tableCheckbox>
            </td>
            <td>{{product.autor}}</td>
            <td>{{product.nombre}}</td>
            <td>{{product.fecha}}</td>
            <td>{{product.type}}</td>
            <td>{{product.peso}}</td>
            <td><a href="product.url" download="Acme Documentation (ver. 2.0.1).txt">Descargar</a></td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </app-tab>
  <app-tab label="Bitácora" icon="pi pi-fw pi-briefcase" [disabled]="true">Bitácora</app-tab>
  <app-tab label="Usuarios por etapa" icon="pi pi-fw pi-users" [disabled]="true">Usuarios por etapa</app-tab>
</app-tabs>

<!-- <app-detalle-lpus [DisplayModal]="DisplayModal" [detalleCubicacion]="detalleCubicacion$|async" (close)="Close()"></app-detalle-lpus> -->
<app-modal [display]="DisplayModal" (CloseEvent)="Close()">
  <ng-container modal-header-title>Detalle de las LPUs</ng-container>
  <ng-container modal-content>
    <app-table [config]="ConfigTableResumen" [items]="detalleCubicacion"></app-table>
    <!-- <span id="total"> <strong>Total:</strong> {{ total| currency : 'CLP' : '$':'.0-2':'es-CL' }}</span> -->
  </ng-container>
  <ng-container modal-footer></ng-container>
</app-modal>
<div class="container-fluid">
  <div class="row">
    <div class="col">
      <h1 class="mt-4" style="color: rgba(0,0,0,.87);font-size: 1.71428571rem;">Perfiles del usuario {{(perfilesUser$|async)[0]?.nombreUser| titlecase}} </h1>
      <!-- <span>listado de perfiles</span> -->
    </div>
    <div class="col">

      <button pButton [routerLink]="['/administracion/usuarios/list-usuarios']" type="button" label="Volver" icon="pi pi-arrow-left" class="p-button-sm mt-5 float-right p-button-outlined"></button>
      <button pButton (click)="openModalAddPerfilUser()" type="button" label="Agregar nuevo Perfil" icon="pi pi-plus" class="p-button-sm mt-5 float-right" id="add-perfil-user-button" style="margin-right: 10px;"></button>

    </div>
    <div class="col-12">
      <hr>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class=" grid">
        <div class="field col-12 table-list-usuarios">
          <ng-container *ngIf="perfilesUser$ | async as perfilesUser">
            <p-table #dt [columns]="['nombre']" [value]="perfilesUser" [rows]="10" [paginator]="true" dataKey="id" responsiveLayout="stack" currentPageReportTemplate="Mostrando {first} al {last} de {totalRecords} elementos" [showCurrentPageReport]="true" styleClass="p-datatable-sm p-datatable-responsive-demo">
              <ng-template pTemplate="caption">
                <div class="p-d-flex p-ai-center p-jc-between">
                  <h5 class="p-m-0"></h5>
                  <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Buscar..." />
                  </span>
                </div>
              </ng-template>

              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="nombre">
                    Perfil
                    <p-sortIcon field="nombre"></p-sortIcon>
                  </th>
                  <th pSortableColumn="superior">
                    Superior
                    <p-sortIcon field="superior"></p-sortIcon>
                  </th>
                  <th pSortableColumn="perfil_propio">
                    Tipo Perfil
                    <p-sortIcon field="perfil_propio"></p-sortIcon>
                  </th>
                  <th></th>
                <tr>
              </ng-template>

              <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
                <tr>
                  <td>
                    <strong>{{ item.nombre }}</strong>
                  </td>
                  <td>{{ item.superior }}</td>
                  <td>{{ item.perfil_propio | titlecase }}</td>
                  <td style="text-align: right; position: relative">
                    <div class="ui icon buttons mini basic">
                      <button class="ui button generic-color" (click)="editarSuperior(item)">Editar Superior</button>
                      <button class="ui button generic-color" (click)="eliminar(item)">
                        <fa-icon [icon]="trashIcon"></fa-icon>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>

              <ng-template pTemplate="summary">
                <div class="p-d-flex p-ai-center p-jc-between">
                  En total hay {{ perfilesUser ? perfilesUser.length : 0 }} elementos.
                </div>
              </ng-template>
            </p-table>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog [visible]="displayModalPerfilesUser$|async" [closable]="false" (onHide)="closeAddPerfil()" [modal]="true" [draggable]="false" [resizable]="false">
  <div class="row">
    <div class="col">
      <p *ngIf="addMode" style="font-size:20px;font-weight: 500;color:#003049;text-align: center;">Nuevo perfil</p>
      <p *ngIf="!addMode" style="font-size:20px;font-weight: 500;color:#003049;text-align: center;">Editar superior</p>
      <div style="padding: 0 9rem 0 9rem;">
        <div class="row">
          <div class="col">
            <form [formGroup]="formAddPerfil">
              <zwc-pdropdown [control]="formAddControls.perfil_id" Label="Perfil" dropdown_id="perfil-usuario-form" [data]="allPerfiles$|async" Pplaceholder="Selecione perfil" [loading]="false" optionLabel="nombre" optionValue="id"></zwc-pdropdown>

              <br>

              <!--
              <div id="superior-perfil-form">
                <app-select [control]="formAddControls.superior_proxy_id" label="Superior directo">
                  <ng-container options>
                    <option value="null" selected disabled>Seleccione persona</option>
                    <option value="null">No posee superior directo</option>
                    <ng-container *ngFor="let superior of posiblesSuperiores$ | async">
                      <option [value]="superior.proxy_id">
                        {{ superior.usuario_nombre }} ({{ superior.perfil_nombre }})
                      </option>
                    </ng-container>
                  </ng-container>
                </app-select>
              </div>
                -->
              <zwc-pdropdown [control]="formAddControls.superior_proxy_id" Label="Superior directo" dropdown_id="superior-perfil-form" [data]="posiblesSuperiores$|async" Pplaceholder="Selecione persona" [loading]="false" optionLabel="usuario_nombre" optionValue="proxy_id"></zwc-pdropdown>
            </form>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <button pButton type="button" *ngIf="addMode" [disabled]="!formAddPerfil.valid" (click)="AgregarPerfil()" label="Agregar Perfil" icon="pi pi-plus" class="p-button-sm mt-5 float-right" id="add-user-perfil-button"></button>
            <button pButton type="button" *ngIf="!addMode" [disabled]="!formAddPerfil.valid" (click)="EditarSuperiorPerfil()" label="Editar Superior" icon="pi pi-plus" class="p-button-sm mt-5 float-right" id="add-user-perfil-button"></button>
            <button pButton type="button" (click)="closeAddPerfil()" label="Cancelar" class="p-button-sm mt-5 float-right" style="background: #b8b6b6; border: gray;"></button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <p-footer></p-footer>
</p-dialog>

<p-dialog [(visible)]="displayModalEliminarPerfilUsuario" [closable]="false" (onHide)="closeModalEliminarPerfilUsuario()" [modal]="true" [draggable]="false" [resizable]="false">
  <div class="row">
    <div class="col">
      <p style="font-size:20px;font-weight: 500;color:#003049;text-align: center;">¿Está seguro que desea eliminar este perfil al usuario?</p>
      <div style="padding: 0 9rem 0 9rem;">
        <div class="row">
          <div class="col">

          </div>
        </div>
        <div class="row">
          <div class="col">
            <button pButton type="button" (click)="EliminarPerfilUsuario()" label="Si, confirmo" icon="pi pi-trash" class="p-button-sm mt-5 float-right" id="delete-perfil-user-button" style="    background: #ffb6b6;
              border: #b36161;
              margin-left: 10px;
              color: #412727;"></button>
            <button pButton type="button" (click)="closeModalEliminarPerfilUsuario()" label="Cancelar" class="p-button-sm mt-5 float-right" id="delete-user-button" style="background: #b8b6b6;
              border: gray;"></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</p-dialog>

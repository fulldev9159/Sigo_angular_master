stages:
  - ci
  - deployment
# - triggers

variables:
  CLI_VERSION: 10.1.6

ci:
  stage: ci
  image: registryv2.zweicom.com:5000/trion/ng-cli-karma:${CLI_VERSION}
  script:
    - cd angular-project
    - npm ci
    - ng lint
    - ng test --code-coverage --progress false --watch false
  coverage: '/^Statements\s*:\s*([^%]+)/'

robotframework:
  stage: ci
  image: registryv2.zweicom.com:5000/robotframework:latest
  script:
    - robot .
    
docker-develop:
  stage: deployment
  image: registryv2.zweicom.com:5000/tmaier/docker-compose:latest
  script:
    - docker-compose -f docker-compose.yml build --no-cache develop
    - docker-compose -f docker-compose.yml push develop

docker:
  stage: deployment
  image: registryv2.zweicom.com:5000/tmaier/docker-compose:latest
  script:
    - docker-compose -f docker-compose.yml build --no-cache deploy
    - docker-compose -f docker-compose.yml push deploy
  only:
    - tags
    - develop
